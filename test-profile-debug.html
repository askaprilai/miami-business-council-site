<!DOCTYPE html>
<html>
<head>
    <title>Profile Debug Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Profile Save Debug Test</h1>

    <div id="status"></div>

    <form id="testForm">
        <input type="text" id="memberName" name="memberName" value="Test User"><br>
        <input type="text" id="memberCompany" name="memberCompany" value="Test Company"><br>
        <input type="text" id="memberTitle" name="memberTitle" value="CEO"><br>
        <select id="memberIndustry" name="memberIndustry">
            <option value="">Select</option>
            <option value="Technology" selected>Technology</option>
        </select><br>
        <input type="url" id="memberLinkedIn" name="memberLinkedIn" value=""><br>
        <button type="button" onclick="testSave()">Test Save</button>
    </form>

    <script>
        const SUPABASE_URL = 'https://vsnvtujkkkbjpuuwxvyd.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzbnZ0dWpra2tianB1dXd4dnlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MzUyNDYsImV4cCI6MjA3MTIxMTI0Nn0.GwWKrl_6zlIBvIaJs8NngoheF24nNzAfBO5_j_d1ogA';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function testSave() {
            const status = document.getElementById('status');
            status.innerHTML = '<h2>Testing...</h2>';

            // Test 1: Check if fields have name attributes
            const nameField = document.querySelector('[name="memberName"]');
            status.innerHTML += `<p>✓ Field with name="memberName" found: ${nameField ? 'YES' : 'NO'}</p>`;

            // Test 2: Check session
            const { data: { session }, error: sessionError } = await supabase.auth.getSession();
            status.innerHTML += `<p>Session: ${session ? '✓ Logged in as ' + session.user.email : '✗ Not logged in'}</p>`;

            if (!session) {
                status.innerHTML += '<p style="color:red;">ERROR: You need to be logged in to the member portal first!</p>';
                return;
            }

            // Test 3: Get member data
            const { data: member, error: memberError } = await supabase
                .from('members')
                .select('*')
                .eq('auth_user_id', session.user.id)
                .single();

            status.innerHTML += `<p>Member found: ${member ? '✓ YES (ID: ' + member.id + ')' : '✗ NO'}</p>`;

            if (!member) {
                status.innerHTML += `<p style="color:red;">ERROR: ${memberError?.message}</p>`;
                return;
            }

            // Test 4: Try to save
            const profileData = {
                first_name: 'Test',
                last_name: 'User',
                company_name: document.getElementById('memberCompany').value,
                job_title: document.getElementById('memberTitle').value,
                industry: document.getElementById('memberIndustry').value,
                linkedin_url: document.getElementById('memberLinkedIn').value
            };

            status.innerHTML += `<p>Attempting save with data: ${JSON.stringify(profileData)}</p>`;

            const { data, error } = await supabase
                .from('members')
                .update(profileData)
                .eq('id', member.id)
                .select()
                .single();

            if (error) {
                status.innerHTML += `<p style="color:red;">✗ SAVE FAILED: ${error.message}</p>`;
                status.innerHTML += `<pre>${JSON.stringify(error, null, 2)}</pre>`;
            } else {
                status.innerHTML += `<p style="color:green;">✓ SAVE SUCCESSFUL!</p>`;
                status.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
        }
    </script>
</body>
</html>
